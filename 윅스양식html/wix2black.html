<style>
body {
  background: #181818;
  color: #fff;
  font-family: 'Pretendard', sans-serif;
}

#leadForm {
  max-width: 700px;
  margin: 0 auto;
  padding: 30px;
  background: #181818;
  border-radius: 0;
}

#leadForm h2 {
  font-size: 28px;
  text-align: center;
  margin-bottom: 30px;
  color: #fff;
}

#leadForm label {
  font-size: 22px;
  font-weight: bold;
  display: block;
  margin-bottom: 5px;
}

#leadForm input,
#leadForm select {
  width: 100%;
  padding: 24px;
  margin-top: 12px;
  margin-bottom: 25px;
  border: 2px solid #777;
  border-radius: 10px;
  font-size: 24px;
  box-sizing: border-box;
  background: #444;
  color: #fff;
}

#leadForm input::placeholder {
  color: #ccc;
}

@keyframes blink {
  0%   {background: #ff9800;}
  50%  {background: #fa35ba;}
  100% {background: #ff9800;}
}

#leadForm button {
  width: 100%;
  background: #014bbb;
  color: #000;
  font-size: 30px;
  font-weight: bold;
  padding: 30px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  animation: blink 2s infinite;
}

#leadForm button:hover {
  background: #45a049;
}
#leadForm button:active {
  background: #2196F3;
}

#leadForm .agreement {
  font-size: 14px;
  margin-top: -10px;
  margin-bottom: 15px;
}

#leadForm .agreement label {
  display: flex;
  align-items: center;
  gap: 6px;
}

#leadForm .agreement input[type="checkbox"] {
  width: 18px;
  height: 18px;
}

#leadForm .agreement a {
  color: #66b3ff;
  text-decoration: underline;
}

#result {
  margin-top: 20px;
  text-align: center;
  font-weight: bold;
  font-size: 18px;
}

/* 모바일 대응 */
@media screen and (max-width: 640px) {
  #leadForm h2 {
    font-size: 20px;
  }
  #leadForm label {
    font-size: 20px;
  }
  #leadForm input,
  #leadForm select {
    font-size: 20px;
    padding: 16px;
  }
  #leadForm button {
    font-size: 20px;
    padding: 25px;
  }
}
</style>

<form id="leadForm">
  <h2>혜택 안내를 위해<br>성함과 연락처를 남겨주세요!</h2>
  <div>
    <label>
      이름
      <input type="text" name="name" required placeholder="이름을 입력하세요">
    </label>
  </div>
  <div>
    <label>
      전화번호
      <input type="tel" name="phone" required placeholder="010-0000-0000" maxlength="13">
    </label>
  </div>
  <div>
    <label>
      임플란트 필요 개수
      <select name="implants">
        <option value="4개 이하">4개 이하.</option>
        <option value="5개">5개.</option>
        <option value="6개 이상" selected>6개 이상.</option>
        <option value="전체">전체.</option>
      </select>
    </label>
  </div>
  <div class="agreement">
    <label>
      <input type="checkbox" name="privacy" checked required>
      <span>
        <a href="https://www.implantevent.com/privacy" target="_blank">개인정보처리방침</a>에 동의합니다.
      </span>
    </label>
  </div>
  <button type="submit">이벤트 신청하기</button>
</form>
<div id="result"></div>

<script>
// 하이픈 자동입력
const phoneInput = document.querySelector('input[name="phone"]');
phoneInput.addEventListener('input', function(e) {
  let numbers = e.target.value.replace(/\D/g, '');
  if (numbers.length > 11) numbers = numbers.slice(0, 11);

  let formatted = '';
  if (numbers.length < 4) {
    formatted = numbers;
  } else if (numbers.length < 8) {
    formatted = numbers.slice(0,3) + '-' + numbers.slice(3);
  } else {
    formatted = numbers.slice(0,3) + '-' + numbers.slice(3,7) + '-' + numbers.slice(7);
  }
  e.target.value = formatted;
  e.target.selectionStart = e.target.selectionEnd = e.target.value.length;
});

// 엔터 누르면 다음 입력으로 이동
const nameInput = document.querySelector('input[name="name"]');
const phoneInput2 = document.querySelector('input[name="phone"]');
const implantsSelect = document.querySelector('select[name="implants"]');

nameInput.addEventListener('keydown', function(e) {
  if (e.key === 'Enter') {
    e.preventDefault();
    phoneInput2.focus();
  }
});
phoneInput2.addEventListener('keydown', function(e) {
  if (e.key === 'Enter') {
    e.preventDefault();
    implantsSelect.focus();
  }
});

// 폼 제출 이벤트
document.getElementById('leadForm').addEventListener('submit', function(e) {
  e.preventDefault();

  if (!this.privacy.checked) {
    alert('개인정보처리방침에 동의해 주세요.');
    return;
  }

  const phoneValue = this.phone.value;
  const submittedData = localStorage.getItem('submitted_' + phoneValue);

  if (submittedData) {
    const savedDate = new Date(submittedData);
    const now = new Date();
    const diffDays = (now - savedDate) / (1000 * 60 * 60 * 24);

    if (diffDays < 30) {
      alert('이미 신청이 완료된 번호입니다.\n30일 이후 다시 신청하실 수 있습니다.');
      return;
    }
  }

  const submitButton = this.querySelector('button[type="submit"]');
  submitButton.disabled = true;
  submitButton.innerText = '처리 중...';

  const formData = new URLSearchParams();
  formData.append('name', this.name.value);
  formData.append('phone', phoneValue);
  formData.append('implants', this.implants.value);

  fetch('https://script.google.com/macros/s/AKfycbxn1L17jtjrZT8kBYEmRRyy0sYNViZX_dK0n6_v0RkhjNH891EVh-zs_2oTJGtSkhb7jw/exec', {
    method: 'POST',
    body: formData
  })
  .then(res => res.text())
  .then(text => {
    localStorage.setItem('submitted_' + phoneValue, new Date().toISOString());
    window.location.href = "https://www.implantevent.com/complete";
  })
  .catch(err => {
    console.error(err);
    document.getElementById('result').innerText = '❌ 전송 실패. 다시 시도해 주세요.';
    submitButton.disabled = false;
    submitButton.innerText = '이벤트 신청하기';
  });
});
</script>
